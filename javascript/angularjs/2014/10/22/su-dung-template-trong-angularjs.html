<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Controller trong AngularJS | Dong Diem Thuy's Blog</title>
        
          <meta name="author" content="dongdiemthuy">
        
        <meta name="title" content="Controller trong AngularJS" >
        <link rel="icon" type="image/png" href="/favicon.png">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
	<meta name="keywords" content="some, relevant, keywords, for, usage, in metatags" />


  <meta name="description" content="AngularJS là khung ứng dụng xây dựng theo mô hình MVC (Model - View - Controller), trong đó thành phần Controller đóng vai trò điều phối tương tác của người dùng đồng thời chịu trách nhiệm trong việc tạo và quản lý Model (định nghĩa bên trong Scope) và gắn kết Scope với View. Bài viết này trình bày về vai trò của Controller trong AngularJS và mối quan hệ của nó với các thành phần còn lại (Scope và View).
">
  <meta property="og:description" content="AngularJS là khung ứng dụng xây dựng theo mô hình MVC (Model - View - Controller), trong đó thành phần Controller đóng vai trò điều phối tương tác của người dùng đồng thời chịu trách nhiệm trong việc tạo và quản lý Model (định nghĩa bên trong Scope) và gắn kết Scope với View. Bài viết này trình bày về vai trò của Controller trong AngularJS và mối quan hệ của nó với các thành phần còn lại (Scope và View).
" />
  <meta name="twitter:description" content="AngularJS là khung ứng dụng xây dựng theo mô hình MVC (Model - View - Controller), trong đó thành phần Controller đóng vai trò điều phối tương tác của người dùng đồng thời chịu trách nhiệm trong việc tạo và quản lý Model (định nghĩa bên trong Scope) và gắn kết Scope với View. Bài viết này trình bày về vai trò của Controller trong AngularJS và mối quan hệ của nó với các thành phần còn lại (Scope và View).
" />

<meta property="og:title" content="Controller trong AngularJS" />
<meta property="og:type" content="article" />
<meta property="og:image" content="/sharer.png" />
<meta property="og:url" content="/javascript/angularjs/2014/10/22/su-dung-template-trong-angularjs.html" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Controller trong AngularJS" />
<meta name="twitter:image" content="/sharer.png" />
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/monokai.css">
    </head>
    <body class="wrap">
      <!--[if lt IE 8]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
      <![endif]-->
      <header>
  <h1 class="site-title"><a href="/">Dong Diem Thuy's Blog</a></h1>
  <nav class="main-nav">
    <div class="grid">
      <ul>
        <li><a href="/">Home</a></li>
        
      </ul>
    </div>
  </nav>
</header>
      <section class="content">
        <div id="home" class="grid post">
<div class="unit whole">
<article>
	<header>
		<h1>Controller trong AngularJS</h1>
		<p class="meta">
			<time class="timeago postlist-meta" datetime="2014-10-22">October 22, 2014</time>
			<a class="button blue share" href="#" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u='+window.location.href,'_blank','height=300,width=600');return false;">Share on fb
			</a>
			
				<a class="button blue share" href="#" target="_blank" onclick="window.open('https://twitter.com/share?url='+window.location.href,'_blank','height=300,width=600');return false;">Share on twitter
				</a>
			
		</p>
	</header>
	<section>
		<p>AngularJS là khung ứng dụng xây dựng theo mô hình MVC (Model - View - Controller), trong đó thành phần <em>Controller</em> đóng vai trò điều phối tương tác của người dùng đồng thời chịu trách nhiệm trong việc tạo và quản lý <em>Model</em> (định nghĩa bên trong Scope) và gắn kết <em>Scope</em> với <em>View</em>. Bài viết này trình bày về vai trò của <em>Controller</em> trong AngularJS và mối quan hệ của nó với các thành phần còn lại (<em>Scope</em> và <em>View</em>).</p>

<h2>Controller trong AngularJS</h2>

<p><a href="https://docs.angularjs.org/guide/controller">Controller</a> trong AngularJS là một đối tượng JavaScript dùng để hỗ trợ <a href="https://docs.angularjs.org/guide/scope">Scope</a> trong việc kiểm soát dữ liệu. Khi một Controller được gắn vào DOM (Document Object Model) thông qua chỉ thị ng-controller thì Angular sẽ tạo ra đối tượng Controller. </p>

<p>Scope được xem như là kết nối giữa View và Controller. Trong AngularJS thì các đối tượng hay biến bắt đầu bằng $. $scope là đối tượng của Scope.</p>

<p><img src="/img/controller-trong-angularjs/ViewController.png" alt="Hình 1. Kết quả chạy chương trình"></p>

<p>Controller được sử dụng để thiết lập các trạng thái ban đầu của $scope và thêm các hành vi cho đối tượng $scope.</p>

<p>Controller có thể kết hợp với $scope thông qua chỉ thị ng-controller hoặc $route service.</p>

<p>Controller và View chia sẻ một đối tượng dùng chung là Scope. Thông thường Controller gắn giá trị cho các thuộc tính trên Scope, View sử dụng các thuộc tính này cho việc hiển thị. Angularjs chịu trách nhiệm cho việc đồng bộ 2 phía (two-way data binding) nghĩa là bất cứ sự thay đổi được thực bởi người dùng trên View thì giá trị Model tương ứng sẽ thay đổi theo và ngược lại, khi giá trị Model thay đổi thì View cũng thay đổi theo.</p>

<h3>Khai báo Controller</h3>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;</span><span class="nx">ANY</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>
<span class="p">...</span>
<span class="o">&lt;</span><span class="sr">/ANY&gt;</span></code></pre></div>

<h2>Ví dụ minh họa</h2>

<p>File exampleController.html </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Example</span> <span class="nx">Controller</span><span class="o">&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/head</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular-animate.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular-route.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular.min.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/javascript/MyController.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">app</span><span class="o">=</span><span class="s2">"myApp"</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">"MyController"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="err">:</span><span class="o">&lt;</span><span class="sr">/p&gt; &lt;input type="text" ng-model="name"</span><span class="err">&gt;
</span>            <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span> <span class="p">{{</span><span class="nx">name</span><span class="p">}}</span> <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html&gt;</span></code></pre></div>

<p>File MyController.js</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,[]);</span>

<span class="nx">myApp</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MyController'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">){</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"Dong Diem Thuy"</span><span class="p">;</span>
<span class="p">}]);</span></code></pre></div>

<p>Kết quả hiển thị</p>

<p><img src="/img/controller-trong-angularjs/result.png" alt="Hình 2. Kết quả chạy chương trình"></p>

<p>Ví dụ trên chỉ có một Controller là MyController, một thành phần input dùng để hiển thị và có thể thay đổi được bởi người dùng và một biểu thức hiển thị giá trị của $scope.name. Ban đầu Controller thiết lập giá trị $scope.name,View sẽ hiển thị tới người dùng giá trị này, khi người dùng thay đổi trên View thì giá trị Model tương ứng lập tức thay đổi theo.</p>

<p>Từ đó ta có thể thấy rằng Controller làm được việc là gán giá trị mặc định cho Model để hiển thị tới người dùng.</p>

<h2>Kế thừa Scope trong AngularJS</h2>

<p>Khi một chỉ thị ng-controller tạo ra một Scope con mới, thì các Scope có thể kế thừa nhau. $scope tương ứng với một Controller có thể truy cập vào phương thức định nghĩa bởi Controller ở cấp cao hơn. Xem thêm <a href="https://github.com/angular/angular.js/wiki/Understanding-Scopes">Angular Scope Inheritance</a>.</p>

<h3>Ví dụ minh họa cho các Controller lồng nhau.</h3>

<p>File NestedController.html</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">charset</span><span class="o">=</span><span class="s2">"ISO-8859-1"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Insert</span> <span class="nx">title</span> <span class="nx">here</span><span class="o">&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular-animate.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular-route.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/angular.min.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"js/javascript/Nested.js"</span><span class="o">&gt;&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">nested</span> <span class="nx">div</span> <span class="p">{</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="nx">solid</span> <span class="mi">2</span><span class="nx">px</span> <span class="nx">red</span><span class="p">;</span>
  <span class="p">}</span>
<span class="o">&lt;</span><span class="sr">/style</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="sr">/head</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">body</span>  <span class="nx">ng</span><span class="o">-</span><span class="nx">app</span><span class="o">=</span><span class="s2">"myApp"</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"nested"</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">"MyCtrl"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span> <span class="nx">Name</span> <span class="o">&lt;</span><span class="sr">/label&gt; &lt;input type="text" ng-model="name"</span><span class="err">&gt;
</span>
        <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"nested"</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">"NestedMyCtrl"</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span> <span class="nx">Name</span> <span class="o">&lt;</span><span class="sr">/label&gt; &lt;input type="text" ng-model="name"</span><span class="err">&gt;
</span>
            <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">"nested"</span> <span class="nx">ng</span><span class="o">-</span><span class="nx">controller</span><span class="o">=</span><span class="s2">"NestedMyCtrl1"</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nx">label</span><span class="o">&gt;</span> <span class="nx">Name</span> <span class="o">&lt;</span><span class="sr">/label&gt; &lt;input type="text" ng-model="name"</span><span class="err">&gt;
</span>         <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>     <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span> <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html&gt;</span></code></pre></div>

<p>File Nested.js</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">myApp</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">'myApp'</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">myApp</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'MyCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"Marry"</span><span class="p">;</span>
<span class="p">}]);</span>

<span class="nx">myApp</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'NestedMyCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
    
<span class="p">}]);</span>

<span class="nx">myApp</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">'SubNestedMyCtrl'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'$scope'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span> <span class="p">{</span>
    
<span class="p">}]);</span></code></pre></div>

<p>Kết quả hiển thị:</p>

<p><img src="/img/controller-trong-angularjs/nested.png" alt="Hình 3. Kết quả chạy chương trình"></p>

<p>Ví dụ trên chỉ có ba Controller là MyCtrl, NestedMyCtrl, SubNestedMyCtrl, một thành phần input dùng để hiển thị và có thể thay đổi được bởi người dùng và một biểu thức hiển thị giá trị của $scope.name. Ban đầu Controller thiết lập giá trị $scope.name, View sẽ hiển thị tới người dùng giá trị này, mặc định là các Controller con NestedMyCtrl, SubNestedMyCtrl sẽ mang giá trị mặc định là Marry theo Controller MyCtrl. Khi thay đổi tên $scope.name ở MyCtrl thì ở NestedMyCtrl và SubNestedMyCtrl cũng sẽ thay đổi theo, nếu thay đổi ở NestedMyCtrl thì chỉ có SubNestedMyCtrl thay đổi theo, có nghĩa là các Controller cha sẽ không bị thay đổi nếu thay đổi các Controller con.</p>

<h2>Testing Controller</h2>

<p>Thực hiện viết Unit Test cho Controller sử dụng <a href="http://jasmine.github.io/">Jasmine</a> và <a href="https://github.com/angular/angular-seed">angular-reed</a>. Jasmine được dùng để mô tả thông số kĩ thuật beforeEach và afterEach để thiết lập và ngắt các mã lệnh. </p>

<p>Sử dụng Inject để khởi tạo các Scope và Controller. Chúng ta không thể khởi tạo 1 Scope là một đối tượng Javascript khi không thể $watch nó. Các $digest được gọi để kích hoạt một lệnh sau khi đã thay đổi scope.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">'MyCtrl'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
  <span class="kd">var</span> <span class="nx">scope</span><span class="p">,</span> <span class="nx">ctrl</span><span class="p">;</span>

  <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$controller</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">scope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
    <span class="nx">ctrl</span> <span class="o">=</span> <span class="nx">$controller</span><span class="p">(</span><span class="nx">MyCtrl</span><span class="p">,</span> <span class="p">{</span> <span class="na">$scope</span><span class="p">:</span> <span class="nx">scope</span> <span class="p">});</span>
  <span class="p">}));</span>

  <span class="nx">it</span><span class="p">(</span><span class="s1">'should change greeting value if name value is changed'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">scope</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">"Frederik"</span><span class="p">;</span>
    <span class="nx">scope</span><span class="p">.</span><span class="nx">$digest</span><span class="p">();</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">scope</span><span class="p">.</span><span class="nx">greeting</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s2">"Greetings Frederik"</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h2>Tài liệu tham khảo</h2>

<ul>
<li><a href="https://docs.angularjs.org/guide/controller">Understanding Controllers</a></li>
<li><a href="https://docs.angularjs.org/api/ng/directive/ngController">ngController</a></li>
<li><a href="http://fdietz.github.io/recipes-with-angular-js/controllers/testing-controllers.html">Recipes AngularJS</a></li>
</ul>

<p>Các bạn có thể tải mã nguồn của ví dụ <a href="https://github.com/dongdiemthuy/">Controller lồng nhau</a> để chạy thử.</p>

	</section>
	<footer>
		
	</footer>
</article>
</div>
</div>
      </section>
      <footer class="grid site-footer">
        <p>&copy;&nbsp;Dong Diem Thuy's Blog</p>
        <p><small>Powered by <a href="http://jekyllrb.com" target="_blank"><em>Jekyll</em></a> using <a href="http://bitwiser.in/bitwiser/" target="_blank"><em>Bitwiser</em></a> theme.</small></p>
      </footer>
      
      <script src="/js/headroom.min.js"></script>
      <script>
        var menu, headroom;
        function stickyHeader(){
          menu = document.querySelector('.main-nav');
          var headroom = new Headroom(menu);
          headroom.init();
        }
        window.onload = stickyHeader;
      </script>
    </body>
</html>
